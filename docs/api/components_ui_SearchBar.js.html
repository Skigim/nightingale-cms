<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/ui/SearchBar.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/ui/SearchBar.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// SearchBar component - uses global window.React
// Uses global window.NightingaleSearchService

/**
 * Nightingale SearchBar Component - Unified Version
 *
 * A single, flexible SearchBar component that can function as:
 * 1. A simple text input (when showDropdown=false or no data provided)
 * 2. A dropdown search with fuzzy matching (when showDropdown=true and data provided)
 *
 * This replaces SearchBar.js, SearchBar_Simple.js, and SearchBar_Fixed.js
 */

function SearchBar({
  value = '',
  onChange,
  placeholder = 'Search...',
  className = '',
  showClearButton = true,
  onClear,
  showSearchIcon = true,
  size = 'md',
  // Dropdown-specific props (optional)
  data = [],
  searchKeys = [],
  fuseOptions = {},
  onResultSelect,
  renderResult,
  showDropdown = false,
  maxResults = 8,
  minQueryLength = 0,
}) {
  const e = window.React.createElement;

  // State for dropdown functionality (only used when showDropdown=true)
  const [isDropdownOpen, setIsDropdownOpen] = window.React.useState(false);
  const [searchResults, setSearchResults] = window.React.useState([]);
  const [highlightedIndex, setHighlightedIndex] = window.React.useState(-1);
  const [hasUserInteracted, setHasUserInteracted] =
    window.React.useState(false);
  const [usingKeyboardNav, setUsingKeyboardNav] = window.React.useState(false);

  // Refs
  const inputRef = window.React.useRef(null);
  const dropdownRef = window.React.useRef(null);
  const resultRefs = window.React.useRef([]);
  const searchServiceRef = window.React.useRef(null);

  // Size configurations
  const sizeClasses = {
    sm: 'px-3 py-2 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-5 py-3 text-lg',
  };

  const iconSizes = {
    sm: 'w-4 h-4',
    md: 'w-5 h-5',
    lg: 'w-6 h-6',
  };

  // Determine if we should use dropdown functionality
  const shouldUseDropdown = showDropdown &amp;&amp; data.length > 0;

  // Memoize search service creation (only if dropdown enabled)
  const createSearchService = window.React.useCallback(() => {
    if (!shouldUseDropdown) return null;

    if (searchKeys.length > 0) {
      const options = {
        keys: searchKeys,
        includeScore: false,
        threshold: 0.3,
        ignoreLocation: true,
        ...fuseOptions,
      };
      return new window.NightingaleSearchService(data, options);
    }
    return null; // Will fall back to simple filtering
  }, [shouldUseDropdown, data, searchKeys, fuseOptions]);

  // Initialize search service only when dropdown is enabled
  window.React.useEffect(() => {
    if (shouldUseDropdown) {
      searchServiceRef.current = createSearchService();
    } else {
      searchServiceRef.current = null;
    }
  }, [shouldUseDropdown, createSearchService]);

  // Handle search when value changes (only for dropdown mode)
  window.React.useEffect(() => {
    if (
      !shouldUseDropdown ||
      !hasUserInteracted ||
      value.length &lt; minQueryLength
    ) {
      setSearchResults([]);
      setIsDropdownOpen(false);
      return;
    }

    const service = searchServiceRef.current;
    if (service) {
      // Use fuzzy search service
      const results = service.search(value).slice(0, maxResults);
      setSearchResults(results);
      setIsDropdownOpen(results.length > 0 || value.length > 0);
    } else {
      // Fallback to simple text filtering
      const filtered = data
        .filter((item) => {
          const searchText = Object.values(item).join(' ').toLowerCase();
          return searchText.includes(value.toLowerCase());
        })
        .slice(0, maxResults);
      setSearchResults(filtered);
      setIsDropdownOpen(filtered.length > 0);
    }
  }, [
    shouldUseDropdown,
    value,
    hasUserInteracted,
    minQueryLength,
    maxResults,
    data,
  ]);

  // Handle result selection (dropdown only)
  const handleResultSelect = window.React.useCallback(
    (result) => {
      setIsDropdownOpen(false);
      setHighlightedIndex(-1);
      setUsingKeyboardNav(false);

      if (onResultSelect) {
        onResultSelect(result);
      }
    },
    [onResultSelect]
  );

  // Handle input focus
  const handleFocus = () => {
    if (shouldUseDropdown) {
      setHasUserInteracted(true);
      if (data.length > 0) {
        setIsDropdownOpen(true);
      }
    }
  };

  // Handle input blur with delay to allow for clicks (dropdown only)
  const handleBlur = (e) => {
    if (!shouldUseDropdown) return;

    // Check if the blur is due to clicking on a dropdown item
    const relatedTarget = e.relatedTarget;
    if (relatedTarget &amp;&amp; dropdownRef.current?.contains(relatedTarget)) {
      return; // Don't close if clicking on dropdown
    }

    setTimeout(() => {
      setIsDropdownOpen(false);
      setHighlightedIndex(-1);
      setUsingKeyboardNav(false);
    }, 200);
  };

  // Handle keyboard navigation (dropdown only)
  const handleKeyDown = (e) => {
    if (!shouldUseDropdown || !isDropdownOpen || searchResults.length === 0)
      return;

    switch (e.key) {
      case 'ArrowDown':
        e.preventDefault();
        setUsingKeyboardNav(true);
        setHighlightedIndex((prev) => {
          const newIndex = prev &lt; searchResults.length - 1 ? prev + 1 : 0;
          // Scroll to view
          setTimeout(() => {
            const element = resultRefs.current[newIndex];
            if (element) {
              element.scrollIntoView({ block: 'nearest' });
            }
          }, 0);
          return newIndex;
        });
        break;
      case 'ArrowUp':
        e.preventDefault();
        setUsingKeyboardNav(true);
        setHighlightedIndex((prev) => {
          const newIndex = prev > 0 ? prev - 1 : searchResults.length - 1;
          // Scroll to view
          setTimeout(() => {
            const element = resultRefs.current[newIndex];
            if (element) {
              element.scrollIntoView({ block: 'nearest' });
            }
          }, 0);
          return newIndex;
        });
        break;
      case 'Enter':
        e.preventDefault();
        if (highlightedIndex >= 0 &amp;&amp; searchResults[highlightedIndex]) {
          handleResultSelect(searchResults[highlightedIndex]);
        }
        break;
      case 'Escape':
        setIsDropdownOpen(false);
        setHighlightedIndex(-1);
        setUsingKeyboardNav(false);
        inputRef.current?.blur();
        break;
    }
  };

  // Handle clear button
  const handleClear = () => {
    if (onClear) {
      onClear();
    } else if (onChange) {
      onChange({ target: { value: '' } });
    }

    if (shouldUseDropdown) {
      setSearchResults([]);
      setIsDropdownOpen(false);
      setHasUserInteracted(false);
    }

    inputRef.current?.focus();
  };

  // Default result renderer (dropdown only)
  const defaultRenderResult = window.React.useCallback(
    (result, index) => {
      const isHighlighted = index === highlightedIndex;

      const displayText =
        result.displayName ||
        result.name ||
        result.title ||
        result.label ||
        `${result.mcn || result.masterCaseNumber || ''} ${result.personName || result.name || ''}`.trim() ||
        JSON.stringify(result);

      return e(
        'div',
        {
          key: result.id || index,
          ref: (el) => {
            if (el) {
              resultRefs.current[index] = el;
            }
          },
          className: `
          p-3 cursor-pointer border-b border-gray-600 last:border-b-0 transition-colors
          ${isHighlighted ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-600'}
        `
            .replace(/\s+/g, ' ')
            .trim(),
          style: { pointerEvents: 'auto' },
          onMouseDown: (e) => {
            e.preventDefault(); // Prevent input blur
            e.stopPropagation();
          },
          onClick: (e) => {
            e.preventDefault();
            e.stopPropagation();
            handleResultSelect(result);
          },
          onMouseEnter: () => {
            if (!usingKeyboardNav) {
              setHighlightedIndex(index);
            }
          },
          onMouseLeave: () => {
            if (!usingKeyboardNav &amp;&amp; highlightedIndex === index) {
              setHighlightedIndex(-1);
            }
          },
        },
        displayText
      );
    },
    [highlightedIndex, usingKeyboardNav, handleResultSelect]
  );

  return e(
    'div',
    { className: `relative ${className}` },
    e(
      'div',
      { className: 'relative' },

      // Search icon
      showSearchIcon &amp;&amp;
        e(
          'div',
          {
            className:
              'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none',
          },
          e(
            'svg',
            {
              className: `${iconSizes[size]} text-gray-400`,
              fill: 'none',
              viewBox: '0 0 24 24',
              stroke: 'currentColor',
            },
            e('path', {
              strokeLinecap: 'round',
              strokeLinejoin: 'round',
              strokeWidth: 2,
              d: 'm21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z',
            })
          )
        ),

      // Input field
      e('input', {
        ref: inputRef,
        type: 'text',
        value: value,
        onChange: onChange,
        onFocus: handleFocus,
        onBlur: handleBlur,
        onKeyDown: handleKeyDown,
        placeholder: placeholder,
        className: `
          w-full bg-gray-700 border border-gray-600 rounded-lg
          text-white placeholder-gray-400 focus:outline-none
          focus:ring-2 focus:ring-blue-500 focus:border-transparent
          ${sizeClasses[size]}
          ${showSearchIcon ? 'pl-10' : ''}
          ${showClearButton &amp;&amp; value ? 'pr-10' : ''}
        `
          .replace(/\s+/g, ' ')
          .trim(),
      }),

      // Clear button
      showClearButton &amp;&amp;
        value &amp;&amp;
        e(
          'button',
          {
            type: 'button',
            onClick: handleClear,
            className: 'absolute inset-y-0 right-0 pr-3 flex items-center',
          },
          e(
            'svg',
            {
              className: `${iconSizes[size]} text-gray-400 hover:text-gray-300`,
              fill: 'none',
              viewBox: '0 0 24 24',
              stroke: 'currentColor',
            },
            e('path', {
              strokeLinecap: 'round',
              strokeLinejoin: 'round',
              strokeWidth: 2,
              d: 'M6 18L18 6M6 6l12 12',
            })
          )
        )
    ),

    // Dropdown results (only when showDropdown is enabled)
    shouldUseDropdown &amp;&amp;
      isDropdownOpen &amp;&amp;
      searchResults.length > 0 &amp;&amp;
      e(
        'div',
        {
          ref: dropdownRef,
          className: `
          absolute z-50 w-full mt-1 bg-gray-800 border border-gray-600
          rounded-lg shadow-lg max-h-64 overflow-y-auto
        `
            .replace(/\s+/g, ' ')
            .trim(),
          onMouseDown: (e) => {
            e.preventDefault(); // Prevent any blur
          },
        },
        searchResults.map((result, index) => {
          const isHighlighted = index === highlightedIndex;
          const content = renderResult
            ? renderResult(result, index)
            : defaultRenderResult(result, index);

          // If using custom renderer, wrap with click handlers
          if (renderResult) {
            return e(
              'div',
              {
                key: result.id || index,
                ref: (el) => {
                  if (el) {
                    resultRefs.current[index] = el;
                  }
                },
                className: `
                p-3 cursor-pointer border-b border-gray-600 last:border-b-0 transition-colors
                ${isHighlighted ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-600'}
              `
                  .replace(/\s+/g, ' ')
                  .trim(),
                style: { pointerEvents: 'auto' },
                onMouseDown: (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                },
                onClick: (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  handleResultSelect(result);
                },
                onMouseEnter: () => {
                  if (!usingKeyboardNav) {
                    setHighlightedIndex(index);
                  }
                },
                onMouseLeave: () => {
                  if (!usingKeyboardNav &amp;&amp; highlightedIndex === index) {
                    setHighlightedIndex(-1);
                  }
                },
              },
              content
            );
          }

          return content;
        })
      )
  );
}

// Make available globally
if (typeof window !== 'undefined') {
  window.SearchBar = SearchBar;
}

// Export for module systems
if (typeof module !== 'undefined' &amp;&amp; module.exports) {
  module.exports = SearchBar;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="FileSystemService.html">FileSystemService</a></li><li><a href="NightingaleSearchService.html">NightingaleSearchService</a></li><li><a href="ToastQueue.html">ToastQueue</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Badge">Badge</a></li><li><a href="global.html#Button">Button</a></li><li><a href="global.html#Card">Card</a></li><li><a href="global.html#CardActions">CardActions</a></li><li><a href="global.html#CardField">CardField</a></li><li><a href="global.html#CardGrid">CardGrid</a></li><li><a href="global.html#CardList">CardList</a></li><li><a href="global.html#Checkbox">Checkbox</a></li><li><a href="global.html#ConfirmationModal">ConfirmationModal</a></li><li><a href="global.html#CountBadge">CountBadge</a></li><li><a href="global.html#DataTable">DataTable</a></li><li><a href="global.html#DateInput">DateInput</a></li><li><a href="global.html#FinancialItemCard">FinancialItemCard</a></li><li><a href="global.html#FinancialItemGrid">FinancialItemGrid</a></li><li><a href="global.html#FinancialItemList">FinancialItemList</a></li><li><a href="global.html#FormField">FormField</a></li><li><a href="global.html#FormModal">FormModal</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#MultiBadge">MultiBadge</a></li><li><a href="global.html#NotesModal">NotesModal</a></li><li><a href="global.html#PersonCreationModal">PersonCreationModal</a></li><li><a href="global.html#ProgressBadge">ProgressBadge</a></li><li><a href="global.html#SearchBar">SearchBar</a></li><li><a href="global.html#Select">Select</a></li><li><a href="global.html#StepperModal">StepperModal</a></li><li><a href="global.html#TOAST_CONFIG">TOAST_CONFIG</a></li><li><a href="global.html#TextInput">TextInput</a></li><li><a href="global.html#Textarea">Textarea</a></li><li><a href="global.html#Validators">Validators</a></li><li><a href="global.html#clearAllToasts">clearAllToasts</a></li><li><a href="global.html#encodeURL">encodeURL</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatPersonName">formatPersonName</a></li><li><a href="global.html#formatPhoneNumber">formatPhoneNumber</a></li><li><a href="global.html#formatProperCase">formatProperCase</a></li><li><a href="global.html#getActiveToastCount">getActiveToastCount</a></li><li><a href="global.html#getAppDateLabel">getAppDateLabel</a></li><li><a href="global.html#getDefaultAppDetails">getDefaultAppDetails</a></li><li><a href="global.html#getFlatFinancials">getFlatFinancials</a></li><li><a href="global.html#getNextId">getNextId</a></li><li><a href="global.html#getUniqueNoteCategories">getUniqueNoteCategories</a></li><li><a href="global.html#initializeToastSystem">initializeToastSystem</a></li><li><a href="global.html#loadBusinessComponents">loadBusinessComponents</a></li><li><a href="global.html#loadComponentLayers">loadComponentLayers</a></li><li><a href="global.html#loadUIComponents">loadUIComponents</a></li><li><a href="global.html#parseAvsAccountBlock">parseAvsAccountBlock</a></li><li><a href="global.html#parseAvsData">parseAvsData</a></li><li><a href="global.html#sanitize">sanitize</a></li><li><a href="global.html#sanitizeHTML">sanitizeHTML</a></li><li><a href="global.html#setSanitizedInnerHTML">setSanitizedInnerHTML</a></li><li><a href="global.html#showSuccessToast">showSuccessToast</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#toInputDateFormat">toInputDateFormat</a></li><li><a href="global.html#updateToastConfig">updateToastConfig</a></li><li><a href="global.html#waitForUIComponents">waitForUIComponents</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Aug 20 2025 13:57:37 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
