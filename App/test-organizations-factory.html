<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OrganizationsTab Factory Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #1f2937;
        color: white;
      }
    </style>
  </head>
  <body>
    <div id="root" class="p-8"></div>

    <script>
      // Initialize basic registries
      window.NightingaleUI = { components: {} };
      window.NightingaleBusiness = { components: {} };
    </script>

    <!-- Load TabBase factory -->
    <script src="../js/components/ui/TabBase.js"></script>

    <!-- Load the refactored component -->
    <script src="../js/components/business/OrganizationsTab.refactored.js"></script>

    <script>
      const { createElement: e, useState } = React;

      // Mock file service
      const mockFileService = {
        writeFile: (data) => Promise.resolve(data),
      };

      // Sample data
      const sampleData = {
        organizations: [
          {
            id: 1,
            name: 'Central Hospital',
            type: 'healthcare',
            email: 'info@centralhospital.com',
            phone: '555-0123',
            status: 'active',
          },
          {
            id: 2,
            name: 'Blue Cross Insurance',
            type: 'insurance',
            email: 'support@bluecross.com',
            phone: '555-0456',
            status: 'active',
          },
          {
            id: 3,
            name: 'Legal Aid Society',
            type: 'legal',
            email: 'help@legalaid.org',
            phone: '555-0789',
            status: 'pending',
          },
        ],
      };

      function TestApp() {
        const [data, setData] = useState(sampleData);

        const handleUpdateData = (newData) => {
          setData(newData);
          console.log('Data updated:', newData);
        };

        return e(
          'div',
          { className: 'max-w-6xl mx-auto' },
          e('h1', { className: 'text-2xl font-bold mb-6' }, 'OrganizationsTab Factory Test'),
          e(
            'div',
            { className: 'mb-4 p-4 bg-blue-900 rounded text-sm' },
            'This demonstrates the refactored OrganizationsTab using the createBusinessComponent factory.'
          ),

          // Original for comparison
          e(
            'div',
            { className: 'mb-8' },
            e('h2', { className: 'text-xl font-semibold mb-4' }, 'Refactored Component (Using Factory)'),
            window.OrganizationsTabRefactored
              ? e(window.OrganizationsTabRefactored, {
                  fullData: data,
                  onUpdateData: handleUpdateData,
                  fileService: mockFileService,
                  onViewModeChange: (mode) => console.log('View mode:', mode),
                  onBackToList: (fn) => console.log('Back function set:', fn),
                })
              : e('div', { className: 'p-4 bg-red-900 rounded' }, 'OrganizationsTabRefactored not available')
          ),

          // Debug info
          e(
            'div',
            { className: 'mt-8 p-4 bg-gray-800 rounded text-xs' },
            e('h3', { className: 'font-semibold mb-2' }, 'Debug Info:'),
            e(
              'ul',
              { className: 'space-y-1' },
              e('li', {}, `createBusinessComponent available: ${!!window.createBusinessComponent}`),
              e('li', {}, `OrganizationsTabRefactored available: ${!!window.OrganizationsTabRefactored}`),
              e('li', {}, `Data organizations count: ${data.organizations.length}`),
              e(
                'li',
                {},
                `TabBase utilities: ${Object.keys({
                  getRegistryComponent: window.getRegistryComponent,
                  resolveComponents: window.resolveComponents,
                  FallbackModal: window.FallbackModal,
                  FallbackButton: window.FallbackButton,
                  FallbackSearchBar: window.FallbackSearchBar,
                })
                  .filter((k) => window[k])
                  .join(', ')}`
              )
            )
          )
        );
      }

      // Render the test app
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(e(TestApp));
    </script>
  </body>
</html>
